# import required libraries
import requests
import re
import numpy as np


url = "https://bazaar.abuse.ch/browse"
page = requests.get(url)

# using regular expression to extract SHA 256 values with 64 string length matching the condition
x = re.findall("[a-fA-F0-9]{64}",page.text)

# selecting only unique values
x = list(set(x))

# save the extracted SHA values as a text file
np.savetxt('SHA_Values.txt',x,fmt='%s')

# opening the file to read
file_obj = open(r"SHA_Values.txt","r")
file_obj.seek(0) 
lines = file_obj.readlines()

response = None
count = 0

# Using public API of virus total 
for line in lines:
    count = count+1
    score_sum = 0 # to see the score from all AV vendors
    
    url = 'https://www.virustotal.com/vtapi/v2/file/report'
    params = {'apikey': '<apikey>', 'resource': line} # API key hidden
    
    response = requests.get(url, params=params).json()
    
    AV_no = len(response['scans'].keys()) # no. of AV companies participating in scoring
    
    for k in response['scans'].keys():
        if response['scans'].get(k).get('detected'):
            score_sum = score_sum + 1
    print(line, ' : ', score_sum, '/', AV_no )
    
    time.sleep(15) # using sleep as only 4 requests per minute allowed in public API
    
    if count > 99: # using count to break as only 500 requests per day allowed in public API
        break


##########################################################################
#import requests
#from bs4 import BeautifulSoup

#URL = "https://bazaar.abuse.ch/browse/"
#page = requests.get(URL)
#soup = BeautifulSoup(page.content, "html.parser")
#for row in soup.findAll('table')[0].tbody.findAll('tr'):
    SHA_column = row.find("a", class_="shortify").text
    print(SHA_column)
